/**
 * This ruleset enforces a security model where data access is restricted to
 * authenticated users. It is designed for a single-user or internal demo
 * application, not a multi-tenant public service.
 *
 * Core Philosophy:
 * The security model operates on a "default deny" principle. Access is explicitly
 * granted only to users who are authenticated via Firebase Authentication (including
 * anonymous users).
 *
 * Data Structure:
 * The data is organized into two distinct, top-level collections:
 * 1. /lottery_results: Stores historical lottery draw results.
 * 2. /pattern_analyses: Stores AI-generated analysis based on the lottery results.
 * This flat structure simplifies rule logic, as all documents within a collection
 * share the same security requirements.
 *
 * Key Security Decisions:
 * - Authenticated Access Only: All operations (read, write, delete) on all
 *   collections are restricted to any signed-in user. The app uses anonymous
 *   authentication to ensure all visitors are signed in.
 * - No Public Access: Unauthenticated users are denied all access.
 * - No User Data Ownership: The structure does not contain user-specific
 *   collections, as it is not a multi-user application.
 *
 * Authorization:
 * Authorization is based simply on the existence of an authenticated user session
 * (`request.auth != null`). This is the simplest security model for this
 * type of application.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ----------------------------------------------------------------------
    // Helper Functions
    // ----------------------------------------------------------------------

    /**
     * Checks if the requesting user is authenticated.
     */
    function isSignedIn() {
      return request.auth != null;
    }

    // ----------------------------------------------------------------------
    // Collection Rules
    // ----------------------------------------------------------------------

    /**
     * @description
     *   Controls access to lottery result documents. Any authenticated user
     *   (including anonymous users) can read or write this data.
     */
    match /lottery_results/{lotteryResultId} {
      allow read, write: if isSignedIn();
    }

    /**
     * @description
     *   Controls access to AI-generated pattern analysis documents. Access is
     *   limited to any authenticated user.
     */
    match /pattern_analyses/{patternAnalysisId} {
      allow read, write: if isSignedIn();
    }
  }
}
